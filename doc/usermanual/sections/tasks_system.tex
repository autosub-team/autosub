\section{The Tasks System} \label{tasks_system}

\subsection{Minimal and optional task structure}

Every task is located in an individual folder in the tasks directory (configurable via 
the autosub config file). Certain structures with minimum behavior are needed in order 
to use the task with the autosub system. In detail instructions how to create a taks can 
be found in Section \ref{create_new_task}.

\begin{tabular}{|p{3cm}|p{10cm}|}
\hline

Minimal & \begin{itemize}
    \item {\bf Generator executable:} Generates random task parameters for the task, 
		creates entity and behavioral vhdl files and description pdf file for the student. Copies
		these files to the user taskpath ({\tt "autosub/src/users/<user\_id>/Task<nr>/"}). Declares
		the files that shall be attached to the task description email and the task parametes and 
		adds them to the autosub system using the tool {\tt "autosub/src/tools/add\_to\_usertasks.py"}.
    \item {\bf Tester executable:} Given the individual task parameters, tries to test
		the student's solution located in {\tt "autosub/src/users/<user\_id>/Task<nr>/"}. 
		Generates an individual test bench for the student's solution. Tests 
        the solution and creates feedback textfile {\tt "error\_msg"}, error attachments in the directory
		{\tt "error\_attachments"} and tells the autosub system the test result via returncode
    \item {\bf description.txt:} Contains a textual task description. The text in description.txt 
    	is sent to the user as the body of the e-mail that contains a new task description.
	\end{itemize} 
\\
\hline
\end{tabular}

\newpage

Certain optional structures have proven to be useful.

\begin{tabular}{|p{3cm}|p{10cm}|}
\hline

Optional & \begin{itemize}
    \item {\bf Diredtory scripts:} Scripts that are called from the executables in order to aid the 
        generation or test process
    \item {\bf Directory templates:} Files that are filled with parameters and can be used to generate entity 
        declarations, test benches or description texts and files for the students.
    \item {\bf Directory static:} Files that are static for the task, therefore the same for every student.
    \item {\bf Directory exam:} Files that are needed for the VELS exam mode.
\end{itemize} 
\\
\hline
\end{tabular} 

An usual sequence for the task generation in VELS is:
\begin{enumerate}
    \item The generator executable is called by the autosub Generator thread.
    \item The generator executable calls a task generation script
        {\tt "scripts/generateTask.py"}.
    \item The task generation script generates random task parameters and returns
        them, fills a LaTeX description template and vhdl templates and stores
        the results in the directory {\tt "tmp/"}.
    \item The generator executable generates the task description pdf file from the
        filled template and copies it, all filled vhdl files and static vhdl files
        to the users task description path.
        {\tt "autosub/src/users/<user\_id>/Task<task\_nr>/desc/"}.
    \item The generator executable calls {\tt "autosub/src/users/<user\_id>/Task<nr>/"} 
		with the task parameters and path to files that need to be attached to the task
		email for the student.
\end{enumerate}

An usual sequence for submission testing in VELS is:
\begin{enumerate}
\item The tester executable is called by a autosub Worker thread.
\item The tester executable calls a testbench generation script
    {\tt "scripts/generateTestBench.py"}.
\item The tesbench generation script creates a testbench with test vectors and returns it.
\item The tester executable stores the testbench and copies needed files from the task.
    description to the user task directory {\tt "autosub/src/users/<user\_id>/Task<task\_nr>"}
\item The tester executable checks if the needed submission files are present in the
	user task directory. These files are stored from email attachments by the Fetcher thread.
\item The tester executable analyzes files generated by the task generation, if errors
    occur the process stops and sends an email to student and system administrator.
\item The tester executable analyzes the student submission files, if errors occur they
    are written to a {\tt error\_msg} file and the process stops.
\item The tester elaborates and runs the testbench, if the tests fail meaningful messages
    are written to a {\tt error\_msg} file and the process stops.
\item The tester returns success.
\end{enumerate}

\subsection{Tasks error detection and logging} \label{tasklog}
The autosub daemon calls generator and tester scripts for the individual tasks. The logging 
of these scripts is done by piping the output of called generator and tester scripts into 
seperate log files. All output to stdout is piped into the logfile {\tt tasks.stdout}, allo 
error output to stderr is piped into the logfile {\tt tasks.stderr}. The location of these
files (default {\tt "autosub/src"}) can be configured using the log file. Messages to the 
files are logged in the format:
\begin{verbatim}
--------------------------------------------------------------------
<date> <time> [Task<task_nr>(<worker_nr)] <ERROR/INFO>:
--------------------------------------------------------------------
<logmessage>
\end{verbatim}

An example for the tester of a submission from the gates task to {\tt tasks.stdout} is:
{\scriptsize
\begin{verbatim}

--------------------------------------------------------------------------------
2017-05-09 15:07:16,124 [Tester1(10) ]INFO:
--------------------------------------------------------------------------------
Parsing VHDL file "gates.vhdl" into library work
Parsing VHDL file "gates_tb_10_Task1.vhdl" into library work
Parsing VHDL file "IEEE_1164_Gates_pkg.vhdl" into library work
Parsing VHDL file "IEEE_1164_Gates.vhdl" into library work
Parsing VHDL file "IEEE_1164_Gates_beh.vhdl" into library work
Parsing VHDL file "gates_beh.vhdl" into library work
Task 1 analyze success for user 10!
Task 1 not using the provided gate entities for user 10!
\end{verbatim}
}
